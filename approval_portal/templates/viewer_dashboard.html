{% extends "base.html" %}
{% block title %}Viewer Dashboard{% endblock %}
{% block content %}

{% if login_only %}
  <div class="login-box">
    <h2>Viewer Login</h2>
    {% if error %}
      <div class="error-box">{{ error }}</div>
    {% endif %}
    <form method="post" class="form-card">
      <div class="form-group">
        <label>Username:</label>
        <input name="username" class="input-line">
      </div>

      <div class="form-group">
        <label>Password:</label>
        <input type="password" name="password" class="input-line">
      </div>

      <button class="btn-primary" type="submit">Login</button>
    </form>
  </div>

{% else %}

<h2 class="page-title">Viewer Dashboard</h2>

<div class="stats-grid">
  <div class="stat-box">Total <strong>{{ stats.total }}</strong></div>
  <div class="stat-box">Pending L1 <strong>{{ stats.pending_l1 }}</strong></div>
  <div class="stat-box">Pending L2 <strong>{{ stats.pending_l2 }}</strong></div>
  <div class="stat-box stat-approved">Approved <strong>{{ stats.approved }}</strong></div>
  <div class="stat-box stat-rejected">Rejected <strong>{{ stats.rejected }}</strong></div>
</div>

<div class="actions">
    <a class="btn-primary" href="{{ url_for('new_request') }}">Create New Request</a>
</div>

<div class="table-wrapper">
  <table class="table table-compact">
    <tr>
      <th>ID</th>
      <th>Project</th>
      <th>Unit</th>
      <th>Buyer</th>
      <th>Status</th>
      <th>Created</th>
      <th>Open</th>
    </tr>

    {% for r in all_requests %}
    <tr>
      <td>{{ r.id }}</td>
      <td>{{ r.project_name }}</td>
      <td>{{ r.unit_number }}</td>
      <td>{{ r.buyer_name }}</td>
      <td>{{ r.status }}</td>
      <td>{{ r.created_at }}</td>
      <td>
        <a class="btn-secondary btn-small"
           href="{{ url_for('view_request', req_id=r.id) }}">
          View
        </a>
      </td>
    </tr>
    {% endfor %}
  </table>
</div>

{% endif %}
{% endblock %}
